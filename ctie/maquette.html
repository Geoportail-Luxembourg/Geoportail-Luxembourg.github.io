<html>
<script src="//apiv3.geoportail.lu/apiv3loader.js"  type="text/javascript"></script>
<link type="text/css" rel="stylesheet" href="index.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

<body>
<div id="govbar" class="govbar govbar-light "><a href="http://gouvernement.lu" target="_blank" class="govbar-logo"><img src="//cdn.public.lu/pictures/logos/gov/gov-light.png" alt="Gouvernement du Grand-Duché de Luxembourg"></a><ul class="govbar-links"><li><a class="govbar-link" href="http://luxembourg.lu/" target="_blank">luxembourg.lu</a></li><li><a class="govbar-link" href="http://guichet.lu/" target="_blank">guichet.lu</a></li><li><a class="govbar-link" href="http://gouvernement.lu/" target="_blank">gouvernement.lu</a></li><li><a class="govbar-link govbar-more" href="http://etat.lu/" title="L’annuaire des sites internets publics luxembourgeois" target="_blank">Autres sites</a></li></ul></div>
<div class="container-fluid">
    <div class="row">
        <div id="map" class="col map"></div>
        <div class="col">
            <h1>Config panel</h1>
            <label>Recherche</label><span id="search"></span><br>
            <label>Url vers un fichier GeoJson</label><input type="text" id="geojsonurl" value="https://map.geoportail.lu/mymaps/features/808e512e88f94c9fbe25ed3eae49895b"><button onclick="loadgeojson()">Import GeoJSON</button><br>
            <div id="layerManager" ></div><br>
            <div id="info"></div><br>
            <button onclick="exportgeojson()">Export Geojson</button><br>
            <button onclick="addInteractions('Point')">Dessiner point</button><br>
            <button onclick="addInteractions('Polygon')">Dessiner polygone</button><br>
            <button onclick="addInteractions('LineString')">Dessiner ligne</button><br>
            <button onclick="removeInteractions()">Désactiver dessin</button><br>
            <button onclick="printPDF()">Génération d'un PDF</button><br>
        </div>
    </div>
</div>
</body>
<script>
var map = new lux.Map({
  layers: [ '1637','359'],
  layerOpacities: [0.75, 0.8],
  layerVisibilities: [false, false],
  target: 'map',
  bgLayer: 'basemap_2015_global',
  zoom: 18,
  position: [75977, 75099],
  search      : {
    target : 'search',
    dataSets : ['Adresse', 'FLIK', 'Parcelle', 'Commune']
  },
  layerManager: {
    target: 'layerManager'
  },
     showLayerInfoPopup : true,
   popupTarget: 'info'
});
map.addControl(new ol.control.ZoomToExtent({extent: [631077,6337091, 724025, 6492411]}));
var sourceFeatures_ = new ol.source.Vector();
var showLayer = new ol.layer.Vector({
    source: sourceFeatures_,
    name: "GeoJSON Layer",
    map: map
});
var modify = new ol.interaction.Modify({source: sourceFeatures_});
map.addInteraction(modify);
var draw = null;
var snap = null;
function removeInteractions() {
    if (draw != null) {
        map.removeInteraction(draw);
        map.removeInteraction(snap);
    }
}
function addInteractions(typeSelect) {
    removeInteractions();


  draw = new ol.interaction.Draw({
    source: sourceFeatures_,
    type: typeSelect,
  });
  map.addInteraction(draw);
  snap = new ol.interaction.Snap({source: sourceFeatures_});
  map.addInteraction(snap);
}

function loadgeojson() {
    var url = document.getElementById('geojsonurl').value;
    fetch(url).then(function(resp) {
      return resp.json();
    }).then(function(json) {
      var format = new ol.format.GeoJSON();
      var features = format.readFeatures(json, {
        dataProjection: 'EPSG:2169',
        featureProjection: 'EPSG:3857'
      });
      sourceFeatures_.addFeatures(features);
      var size = /** @type {Array<number>} */ (map.getSize());
      map.getView().fit(sourceFeatures_.getExtent(), {size: size});
   });
}
function exportgeojson() {
    var writer = new ol.format.GeoJSON();
    var geojsonStr = writer.writeFeatures(showLayer.getSource().getFeatures());
    document.getElementById('info').innerHTML = geojsonStr;
}
function printPDF() {
map.print()
}
</script>
</html>
